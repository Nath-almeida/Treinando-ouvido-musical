<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinamento Auditivo Musical</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        /* Container principal do App */
        .app-container {
            max-width: 500px;
            width: 90%;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Estilos para o placar */
        .score-board {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        .score-board .score-item {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .score-board #acertos {
            color: green;
            border: 1px solid green;
        }
        .score-board #erros {
            color: red;
            border: 1px solid red;
        }


        /* Estilos para a caixa de √°udio da pergunta */
        .audio-box {
            background-color: #f8f8f8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .question-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Barra de progresso (simulada) */
        .progress-bar-container {
            flex-grow: 1; 
            height: 8px;
            background-color: #e0e0e0;
            margin: 0 10px;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            width: 100%; 
            height: 100%;
            background-color: #495057; /* Cinza escuro para combinar */
        }

        /* Bot√£o principal de Play */
        #playMisteriosa {
            padding: 10px 15px;
            font-size: 18px;
            background-color: transparent;
            color: #333;
            border: none; 
            cursor: pointer;
        }
        
        /* Layout dos bot√µes de nota em Grid de 2 colunas */
        .nota-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-top: 20px;
        }
        
        /* Estilo dos bot√µes de nota */
        .nota-buttons button {
            background-color: #e9ecef;
            color: #333;
            height: 60px;
            font-size: 1.2em;
            border-radius: 8px;
            border: 1px solid #ccc;
            padding: 0;
            width: 100%;
        }

        /* MUDAN√áA AQUI: Estilo para a nota selecionada (CINZA) */
        .nota-buttons button.selected {
            background-color: #adb5bd; /* Cinza claro */
            color: white;             /* Texto branco para contraste */
            border: 1px solid #6c757d; 
            transform: scale(1.02);   
        }

        /* NOVO BOT√ÉO: Confirmar */
        #confirmar {
            width: 100%;
            padding: 15px;
            background-color: #28a745; /* Verde para a√ß√£o de confirma√ß√£o */
            color: white;
            font-size: 1.2em;
            margin-top: 20px;
            border-radius: 8px;
        }

        /* Feedback de acerto/erro */
        #feedback {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="score-board">
            <div class="score-item" id="acertos">Acertos: 0</div>
            <div class="score-item" id="erros">Erros: 0</div>
        </div>

        <div class="audio-box">
            <div class="question-bar">
                <button id="playMisteriosa">‚ñ∂Ô∏è</button>
                
                <div class="progress-bar-container">
                    <div class="progress-bar"></div>
                </div>
                
                <span id="question-label">?</span>
            </div>
            <span style="display: block; text-align: left; margin-top: 5px;">Question Note</span>
        </div>
        
        <div class="nota-buttons">
            <button data-nota="C4">C</button>
            <button data-nota="D4">D</button>
            <button data-nota="E4">E</button>
            <button data-nota="F4">F</button>
            <button data-nota="G4">G</button>
            <button data-nota="A4">A</button>
            <button data-nota="B4">B</button>
        </div>
        
        <button id="confirmar">‚úÖ Confirmar</button>

        <div id="feedback">Toque em ‚ñ∂Ô∏è para come√ßar!</div>

        <p style="font-size: 0.8em; color: #666; margin-top: 20px;">
            Treino de ouvido musical.
        </p>
    </div>

    <script>
        // NOVAS VARI√ÅVEIS DE PONTUA√á√ÉO
        let acertos = 0;
        let erros = 0;
        let notaMisteriosa = null;
        let escolhaUsuario = null;
        let rodadaAtiva = false; // Flag para saber se o jogo est√° esperando uma resposta

        // Vari√°veis do DOM para atualiza√ß√£o
        const feedback = document.getElementById('feedback');
        const acertosDisplay = document.getElementById('acertos');
        const errosDisplay = document.getElementById('erros');
        const playButton = document.getElementById('playMisteriosa');
        const confirmarButton = document.getElementById('confirmar'); // NOVO
        const allNoteButtons = document.querySelectorAll('.nota-buttons button');

        // WEB AUDIO API
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        const notas = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4']; // 7 notas
        const freqMap = {
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
            'G4': 392.00, 'A4': 440.00, 'B4': 493.88
        };

        // Fun√ß√£o de √°udio (mantida)
        async function tocarNota(nota) {
            const frequency = freqMap[nota];
            if (!frequency) return;

            // ... (L√≥gica do Web Audio API) ...
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine'; 
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            const duration = 0.5;
            const attackTime = 0.01;
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime); 
            gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + attackTime); 
            gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration); 
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration + 0.05);

            return new Promise(resolve => {
                setTimeout(resolve, (duration + 0.1) * 1000);
            });
        }
        
        // Fun√ß√£o para atualizar o placar
        function atualizarPlacar() {
            acertosDisplay.textContent = `Acertos: ${acertos}`;
            errosDisplay.textContent = `Erros: ${erros}`;
        }
        
        // Inicia ou repete a rodada
        function iniciarRodada() {
            // Gera uma nova nota misteriosa e limpa o estado
            notaMisteriosa = notas[Math.floor(Math.random() * notas.length)];
            escolhaUsuario = null;
            rodadaAtiva = true;
            
            feedback.textContent = 'Qual √© a nota? Selecione sua resposta.';
            allNoteButtons.forEach(btn => btn.classList.remove('selected')); // Limpa sele√ß√£o
            
            tocarNota(notaMisteriosa);
            playButton.textContent = 'üîÅ'; // Indica que agora repete
            confirmarButton.disabled = false; // Habilita o confirmar
        }

        // ------------------------------------------------------------------
        // L√ìGICA DE INTERA√á√ÉO
        // ------------------------------------------------------------------

        // Bot√£o Play/Repetir Rodada
        playButton.addEventListener('click', async () => {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            if (!rodadaAtiva) {
                iniciarRodada();
            } else {
                await tocarNota(notaMisteriosa); // Repete a nota
            }
        });


        // Bot√µes de notas (Apenas Sele√ß√£o)
        allNoteButtons.forEach(button => {
            button.addEventListener('click', async () => {
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }

                const nota = button.getAttribute('data-nota');
                await tocarNota(nota);
                
                // L√≥gica de Sele√ß√£o: Deixa o bot√£o clicado em CINZA
                allNoteButtons.forEach(btn => {
                    btn.classList.remove('selected');
                });
                button.classList.add('selected');

                // Armazena a escolha, mas N√ÉO CONFIRMA
                escolhaUsuario = nota;
                feedback.textContent = `Nota ${nota.slice(0, 1)} selecionada. Clique em CONFIRMAR.`;
            });
        });
        
        // NOVO EVENTO: Bot√£o Confirmar (Verifica√ß√£o)
        confirmarButton.addEventListener('click', () => {
            if (!rodadaAtiva) {
                feedback.textContent = 'Toque em ‚ñ∂Ô∏è para come√ßar a rodada.';
                return;
            }
            if (!escolhaUsuario) {
                feedback.textContent = 'Por favor, selecione uma nota primeiro.';
                return;
            }

            // L√≥gica de Confirma√ß√£o e Pontua√ß√£o
            if (escolhaUsuario === notaMisteriosa) {
                feedback.textContent = 'Acertou! ‚úÖ Toque em ‚ñ∂Ô∏è para a pr√≥xima nota!';
                acertos++;
                rodadaAtiva = false; // Encerra a rodada
                playButton.textContent = '‚ñ∂Ô∏è'; // Volta o √≠cone para Play (nova rodada)
            } else {
                feedback.textContent = `Errou. ‚ùå A nota era ${notaMisteriosa.slice(0, 1)}. Toque em ‚ñ∂Ô∏è para a pr√≥xima.`;
                erros++;
                rodadaAtiva = false; // Encerra a rodada ap√≥s a revela√ß√£o
                playButton.textContent = '‚ñ∂Ô∏è';
                // Opcional: destaque a nota correta em verde aqui antes de resetar
            }
            
            confirmarButton.disabled = true;
            atualizarPlacar();
        });


        // Inicializa o placar
        atualizarPlacar();
    </script>
</body>
</html>